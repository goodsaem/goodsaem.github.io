<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>11. Free Certificate Issuance | goodSaem</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="alternate" type="application/rss+xml" href="https://goodsaem.github.io/rss.xml" title="goodSaem RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://goodsaem.github.io/feed.atom" title="goodSaem Atom Feed">
    <link rel="alternate" type="application/json" href="https://goodsaem.github.io/feed.json" title="goodSaem JSON Feed">
    <meta name="description" content="11. Free Certificate Issuance">
    <meta name="google-site-verification" content="TgI6W9yu3WmEvVxC8vfAGVxwUfd4J1RgQa_BoB8ZZvU">
    
    <link rel="preload" href="/assets/css/0.styles.f1a3f1e8.css" as="style"><link rel="preload" href="/assets/js/app.4473d647.js" as="script"><link rel="preload" href="/assets/js/3.0812e6ab.js" as="script"><link rel="preload" href="/assets/js/28.c63ae85b.js" as="script"><link rel="prefetch" href="/assets/js/1.50368bbf.js"><link rel="prefetch" href="/assets/js/10.613617a7.js"><link rel="prefetch" href="/assets/js/11.2f34c78c.js"><link rel="prefetch" href="/assets/js/12.6af6635c.js"><link rel="prefetch" href="/assets/js/13.aea5dfae.js"><link rel="prefetch" href="/assets/js/14.59895dd8.js"><link rel="prefetch" href="/assets/js/15.6b28bd70.js"><link rel="prefetch" href="/assets/js/16.f11691e7.js"><link rel="prefetch" href="/assets/js/17.bbb89193.js"><link rel="prefetch" href="/assets/js/18.3daceb03.js"><link rel="prefetch" href="/assets/js/19.79fdeb1b.js"><link rel="prefetch" href="/assets/js/20.34f6c257.js"><link rel="prefetch" href="/assets/js/21.9b372a0e.js"><link rel="prefetch" href="/assets/js/22.0d71a9ad.js"><link rel="prefetch" href="/assets/js/23.feeb8f98.js"><link rel="prefetch" href="/assets/js/24.7c5445bb.js"><link rel="prefetch" href="/assets/js/25.f249c685.js"><link rel="prefetch" href="/assets/js/26.c18c612c.js"><link rel="prefetch" href="/assets/js/27.7f072c08.js"><link rel="prefetch" href="/assets/js/29.da2e8849.js"><link rel="prefetch" href="/assets/js/30.a4b82a57.js"><link rel="prefetch" href="/assets/js/31.410e404a.js"><link rel="prefetch" href="/assets/js/32.b0c22935.js"><link rel="prefetch" href="/assets/js/33.278fbfc7.js"><link rel="prefetch" href="/assets/js/34.975d988f.js"><link rel="prefetch" href="/assets/js/35.7f781580.js"><link rel="prefetch" href="/assets/js/36.b8bc6584.js"><link rel="prefetch" href="/assets/js/37.c83c3b34.js"><link rel="prefetch" href="/assets/js/38.8fffda8b.js"><link rel="prefetch" href="/assets/js/39.e24c3f76.js"><link rel="prefetch" href="/assets/js/4.52440be6.js"><link rel="prefetch" href="/assets/js/40.de7256a4.js"><link rel="prefetch" href="/assets/js/41.9d1224b4.js"><link rel="prefetch" href="/assets/js/42.7c980e81.js"><link rel="prefetch" href="/assets/js/43.3c04a5bb.js"><link rel="prefetch" href="/assets/js/44.9424880d.js"><link rel="prefetch" href="/assets/js/45.052c7c56.js"><link rel="prefetch" href="/assets/js/46.11c3e75a.js"><link rel="prefetch" href="/assets/js/47.5d274762.js"><link rel="prefetch" href="/assets/js/48.39d0d773.js"><link rel="prefetch" href="/assets/js/49.bb020f84.js"><link rel="prefetch" href="/assets/js/5.1e23e5c3.js"><link rel="prefetch" href="/assets/js/50.b3bd21b1.js"><link rel="prefetch" href="/assets/js/51.62d6468b.js"><link rel="prefetch" href="/assets/js/52.7e6541d4.js"><link rel="prefetch" href="/assets/js/53.ec6fef6f.js"><link rel="prefetch" href="/assets/js/54.d17e196d.js"><link rel="prefetch" href="/assets/js/55.87810160.js"><link rel="prefetch" href="/assets/js/56.99f91954.js"><link rel="prefetch" href="/assets/js/57.4fbb2b87.js"><link rel="prefetch" href="/assets/js/58.a39a982d.js"><link rel="prefetch" href="/assets/js/59.b8cfd7eb.js"><link rel="prefetch" href="/assets/js/6.43a36aad.js"><link rel="prefetch" href="/assets/js/60.a583c6e5.js"><link rel="prefetch" href="/assets/js/61.140ff023.js"><link rel="prefetch" href="/assets/js/62.d2873dcc.js"><link rel="prefetch" href="/assets/js/63.3feb9878.js"><link rel="prefetch" href="/assets/js/64.67b50498.js"><link rel="prefetch" href="/assets/js/65.e45d7432.js"><link rel="prefetch" href="/assets/js/66.13e8be4b.js"><link rel="prefetch" href="/assets/js/67.3d03c32f.js"><link rel="prefetch" href="/assets/js/68.ba4651d0.js"><link rel="prefetch" href="/assets/js/69.122740fd.js"><link rel="prefetch" href="/assets/js/7.ac109596.js"><link rel="prefetch" href="/assets/js/70.26035ffc.js"><link rel="prefetch" href="/assets/js/71.efeb0930.js"><link rel="prefetch" href="/assets/js/72.449a3f82.js"><link rel="prefetch" href="/assets/js/73.a3e43300.js"><link rel="prefetch" href="/assets/js/74.baa5611f.js"><link rel="prefetch" href="/assets/js/75.dcd518a9.js"><link rel="prefetch" href="/assets/js/76.e129859d.js"><link rel="prefetch" href="/assets/js/77.73994954.js"><link rel="prefetch" href="/assets/js/78.19d5a05a.js"><link rel="prefetch" href="/assets/js/79.7406a3c7.js"><link rel="prefetch" href="/assets/js/8.785597b0.js"><link rel="prefetch" href="/assets/js/80.0d1cfe2f.js"><link rel="prefetch" href="/assets/js/81.38152694.js"><link rel="prefetch" href="/assets/js/82.f818a44c.js"><link rel="prefetch" href="/assets/js/83.f0542f3a.js"><link rel="prefetch" href="/assets/js/84.bb6f52fd.js"><link rel="prefetch" href="/assets/js/85.39024ec5.js"><link rel="prefetch" href="/assets/js/86.0462dae1.js"><link rel="prefetch" href="/assets/js/87.26001712.js"><link rel="prefetch" href="/assets/js/88.ee9e59e7.js"><link rel="prefetch" href="/assets/js/89.7bf0fa00.js"><link rel="prefetch" href="/assets/js/9.75d699b4.js"><link rel="prefetch" href="/assets/js/90.701af747.js"><link rel="prefetch" href="/assets/js/91.f82f2cf8.js"><link rel="prefetch" href="/assets/js/92.2a8b68c4.js"><link rel="prefetch" href="/assets/js/93.427f8d10.js"><link rel="prefetch" href="/assets/js/94.516fd98e.js"><link rel="prefetch" href="/assets/js/95.2f0606e7.js"><link rel="prefetch" href="/assets/js/96.758a2e88.js"><link rel="prefetch" href="/assets/js/97.31c5c638.js"><link rel="prefetch" href="/assets/js/98.541e1c5a.js"><link rel="prefetch" href="/assets/js/99.a5965daa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f1a3f1e8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><main class="page"> <div class="theme-default-content content__default"><h1 id="_11-free-certificate-issuance"><a href="#_11-free-certificate-issuance" class="header-anchor">#</a> <i class="fas fa-server"></i> 11. Free Certificate Issuance</h1> <p>nginx 에 https 서비스를 구성하기 위해서는 도메인이 필요합니다. 도메인이 준비되면 certbot을 통해서 무료 ssl 인증서 적용 및 http/2 적용이
가능한데요 무료 도메인 가입부터 nginx 에 셋팅하는 부분까지 진행해 보겠습니다.</p> <h3 id="free-domain-regist"><a href="#free-domain-regist" class="header-anchor">#</a> free domain regist</h3> <p><a href="https://www.freenom.com/en/index.html?lang=en" target="_blank" rel="noopener noreferrer">https://www.freenom.com/en/index.html?lang=en<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> freenom 이란
사이트에 회원가입을 한후 도메인 등록을 진행합니다.</p> <ol><li><p>로그인 후 원하는 도메인을 입력하고 엔터키를 클릭한후 사용하고자 하는 도메인에서 Get it now! 버튼을 클릭하여 선택합니다.
그리고 나서 <strong>Checkout</strong> 버튼을 클릭합니다.</p> <ul><li><img src="/assets/img/35.3c18ee3e.jpg" alt="img"></li></ul></li> <li><p>Use DNS 버튼을 클릭하고 Use Freenom DNS Service를 선택한후 aws free tier의 퍼블릭 ipv4 주소를 입력하고 Continue 버튼을 클릭합니다.</p> <ul><li><img src="/assets/img/36.d9bf7487.jpg" alt="img"></li></ul></li> <li><p>도메인 주문이 완료되었습니다.</p> <ul><li><img src="/assets/img/38.247975f7.jpg" alt="img"></li></ul></li> <li><p>My Domain 에서 주문한 도메인 확인이 가능합니다.</p> <div class="custom-block tip"><p class="custom-block-title">goodsaem.ml</p> <p>무료 도메인을 2개 신청했는데 2번째꺼는 어떤이유인지 mydomain에 추가 되지 않아 goodsaem.ml로 셋팅 진행하겠습니다.</p></div> <ul><li><img src="/assets/img/39.e452f436.jpg" alt="img"></li></ul></li></ol> <h3 id="diffie-hellman-key-generation"><a href="#diffie-hellman-key-generation" class="header-anchor">#</a> Diffie-Hellman Key generation</h3> <p>디피와 헬만이 1976년도에 발표한 비밀키 교환 방식의 알고리즘 입니다. 이를 이용하여 4096 bit의 키를 생성하겠습니다.
아래 명령어로 키를 생성하는데 대략 10분정도 소요 되었습니다. 이키를 이용해서 https에서 비밀키를 교환하여 안정한
https 통신을 할수 있으므로 반드시 진행해야 되는 사항입니다.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ubuntu@goodsaem:~$ <span class="token function">sudo</span> openssl dhparam -out /etc/nginx/conf.d/ssl-dhparams.pem <span class="token number">4096</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="let-s-encrypt-certbot"><a href="#let-s-encrypt-certbot" class="header-anchor">#</a> Let's Encrypt &amp;&amp; Certbot</h3> <p>Let's Encrypt 는 사용자에게 무료로 SSL/TLS 인증서를 발급해 주는 기관 입니다. 한번 발급 받으면 90일간 사용이 가능하며
만료 30일전에 메일로 내용을 통보하면 그때 다시 갱신이 가능합니다. 인증서 발급은 certbot certbot-auto 를 이용하여
발급 및 갱신합니다.</p> <p>certbot 등록을 위해 repository 등록을 진행합니다.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ubuntu@goodsaem:~$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update
ubuntu@goodsaem:~$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> software-properties-common
ubuntu@goodsaem:~$ <span class="token function">sudo</span> add-apt-repository universe
ubuntu@goodsaem:~$ <span class="token function">sudo</span> add-apt-repository ppa:certbot/certbot
ubuntu@goodsaem:~$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>certbot을 설치합니다.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ubuntu@goodsaem:~$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> certbot
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>certbot nginx 플러그인을 설치 합니다.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ubuntu@goodsaem:~$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python-certbot-nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>nginx에 서버 이름을 변경하기 위해 아래와 같이 입력합니다.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ubuntu@goodsaem:~$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/nginx/conf.d/default.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>서버 네임을 freenom에서 발급받은 도메인으로 지정해 줍니다.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>server_name  goodsaem.ml<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>이제 아래 certbot 명령어를 통해서 ssl 인증서를 발급받습니다. 인증서 발급시
사용할 admin email 주소와 이용약관 동의 옵션을 지정하여 인증서 발급을 받겠습니다.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ubuntu@goodsaem:~$ <span class="token function">sudo</span> certbot --nginx --email goodsaem@protonmail.com --agree-tos
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>위에 명령어를 입력하면 아래와 같은 형태로 진행되는데요 중요한 부분만 설명하겠습니다.</p> <ul><li><em><strong>7</strong></em> 라인에 추가할 https 도메인이 보입니다.</li> <li><em><strong>10</strong></em> 라인에서 엔터를 입력합니다.</li> <li><em><strong>24</strong></em> 라인에서 e를 입력합니다.(제가 기존에 등록한 도메인이 있어 추가할거라고 물어보는데 추가한다고 하고 진행합니다.)</li> <li><em><strong>37,41</strong></em> 라인 보시면 http로 요청이 오면 https로 리다이렉트 할것인지 물어보는데 전 2번을 선택하여 리다이렉트를 진행합니다.</li></ul> <div class="language-shell line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-shell"><code>Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator nginx, Installer nginx

Which names would you like to activate HTTPS for?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
<span class="token number">1</span>: goodsaem.ml
<span class="token number">2</span>: goodsaem.ml
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate numbers separated by commas and/or spaces, or leave input
blank to <span class="token keyword">select</span> all options shown <span class="token punctuation">(</span>Enter <span class="token string">'c'</span> to cancel<span class="token punctuation">)</span>: 

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
You have an existing certificate that contains a portion of the domains you
requested <span class="token punctuation">(</span>ref: /etc/letsencrypt/renewal/goodsaem.ml.conf<span class="token punctuation">)</span>

It contains these names: goodsaem.ml

You requested these names <span class="token keyword">for</span> the new certificate: goodsaem.ml,
goodsaem.ml.

Do you want to <span class="token function">expand</span> and replace this existing certificate with the new
certificate?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
<span class="token punctuation">(</span>E<span class="token punctuation">)</span>xpand/<span class="token punctuation">(</span>C<span class="token punctuation">)</span>ancel:e  
Renewing an existing certificate
Performing the following challenges:
http-01 challenge <span class="token keyword">for</span> goodsaem.ml
Using default address <span class="token number">80</span> <span class="token keyword">for</span> authentication.
Waiting <span class="token keyword">for</span> verification<span class="token punctuation">..</span>.
Cleaning up challenges
Deploying Certificate to VirtualHost /etc/nginx/conf.d/default.conf
Deploying Certificate to VirtualHost /etc/nginx/conf.d/default.conf

Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
<span class="token number">1</span>: No redirect - Make no further changes to the webserver configuration.
<span class="token number">2</span>: Redirect - Make all requests redirect to secure HTTPS access. Choose this <span class="token keyword">for</span>
new sites, or <span class="token keyword">if</span> you<span class="token string">'re confident your site works on HTTPS. You can undo this
change by editing your web server'</span>s configuration.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number <span class="token punctuation">[</span><span class="token number">1</span>-2<span class="token punctuation">]</span> <span class="token keyword">then</span> <span class="token punctuation">[</span>enter<span class="token punctuation">]</span> <span class="token punctuation">(</span>press <span class="token string">'c'</span> to cancel<span class="token punctuation">)</span>: <span class="token number">2</span>
Redirecting all traffic on port <span class="token number">80</span> to ssl <span class="token keyword">in</span> /etc/nginx/conf.d/default.conf
No matching insecure server blocks listening on port <span class="token number">80</span> found.

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Your existing certificate has been successfully renewed, and the new certificate
has been installed.

The new certificate covers the following domains: https://goodsaem.ml
and https://goodsaem.ml

You should <span class="token builtin class-name">test</span> your configuration at:
https://www.ssllabs.com/ssltest/analyze.html?d<span class="token operator">=</span>goodsaem.ml
https://www.ssllabs.com/ssltest/analyze.html?d<span class="token operator">=</span>goodsaem.ml
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

IMPORTANT NOTES:
 - Congratulations<span class="token operator">!</span> Your certificate and chain have been saved at:
   /etc/letsencrypt/live/goodsaem.ml/fullchain.pem
   Your key <span class="token function">file</span> has been saved at:
   /etc/letsencrypt/live/goodsaem.ml/privkey.pem
   Your cert will expire on <span class="token number">2021</span>-06-03. To obtain a new or tweaked
   version of this certificate <span class="token keyword">in</span> the future, simply run certbot again
   with the <span class="token string">&quot;certonly&quot;</span> option. To non-interactively renew *all* of
   your certificates, run <span class="token string">&quot;certbot renew&quot;</span>
 - If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><p>제되로 인증서 발급이 되었는지 확인해 보겠습니다.
domain에 보시면 goodsaem.ml와 goodsaem.ml 도메인이 등록되어 있습니다. 또한 9,10 라인에
fullchain.pem 키와 privkey.pem 파일이 정상 생성되었음을 확인할수 있습니다.</p> <div class="language-shell line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-shell"><code>ubuntu@goodsaem:~$ <span class="token function">sudo</span> certbot certificates
Saving debug log to /var/log/letsencrypt/letsencrypt.log

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Found the following certs:
  Certificate Name: goodsaem.ml
    Domains: goodsaem.ml goodsaem.ml
    Expiry Date: <span class="token number">2021</span>-06-03 <span class="token number">13</span>:54:40+00:00 <span class="token punctuation">(</span>VALID: <span class="token number">89</span> days<span class="token punctuation">)</span>
    Certificate Path: /etc/letsencrypt/live/goodsaem.ml/fullchain.pem
    Private Key Path: /etc/letsencrypt/live/goodsaem.ml/privkey.pem
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>nginx에 ssl 관련 설정이 등록되었는지 default.conf 내용을 확인해 보겠습니다.
74번라인부터 114번 라인까지 ssl 관련 설정이 추가되었습니다.</p> <div class="language-shell line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-shell"><code>ubuntu@goodsaem:~$ <span class="token function">cat</span> /etc/nginx/conf.d/default.conf

server <span class="token punctuation">{</span>
    server_name  goodsaem.ml<span class="token punctuation">;</span>

    charset utf-8<span class="token punctuation">;</span>
    access_log  /var/log/nginx/localhost.access.log  main<span class="token punctuation">;</span>
    error_log /var/log/nginx/localhost.error.log<span class="token punctuation">;</span>

    <span class="token comment">#root /usr/share/nginx/html;</span>
    root /home/ubuntu/phprest/public<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
        <span class="token comment">#root   /usr/share/nginx/html;</span>
        <span class="token comment">#index  index index.php index.html index.htm;</span>
        try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.php?<span class="token variable">$args</span><span class="token punctuation">;</span>
        <span class="token comment">#error_page 405 =200 $uri;</span>
    <span class="token punctuation">}</span>

    error_page <span class="token number">405</span> <span class="token operator">=</span><span class="token number">200</span> <span class="token variable">$uri</span><span class="token punctuation">;</span>

   
    error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        root /usr/share/nginx/html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">#error_page  404              /404.html;</span>

    <span class="token comment"># redirect server error pages to the static page /50x.html</span>
    <span class="token comment">#</span>
    <span class="token comment">#error_page   500 502 503 504  /50x.html;</span>
    <span class="token comment">#location = /50x.html {</span>
    <span class="token comment">#    root   /usr/share/nginx/html;</span>
    <span class="token comment">#}</span>

    <span class="token comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span>
    <span class="token comment">#</span>
    location ~ <span class="token punctuation">\</span>.php$ <span class="token punctuation">{</span>
        <span class="token comment">#fastcgi_pass unix:/run/php/php-fpm.sock;</span>
        proxy_pass   http://127.0.0.1<span class="token punctuation">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
        include fastcgi_params<span class="token punctuation">;</span>

        fastcgi_pass <span class="token number">127.0</span>.0.1:9000<span class="token punctuation">;</span>
        proxy_redirect off<span class="token punctuation">;</span>
        fastcgi_intercept_errors on<span class="token punctuation">;</span>
        fastcgi_read_timeout <span class="token number">300</span><span class="token punctuation">;</span>
        fastcgi_send_timeout <span class="token number">300</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span>
    <span class="token comment">#</span>
    <span class="token comment">#location ~ \.php$ {</span>
    <span class="token comment">#    root           html;</span>
    <span class="token comment">#    fastcgi_pass   127.0.0.1:9000;</span>
    <span class="token comment">#    fastcgi_index  index.php;</span>
    <span class="token comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span>
    <span class="token comment">#    include        fastcgi_params;</span>
    <span class="token comment">#}</span>

    <span class="token comment"># deny access to .htaccess files, if Apache's document root</span>
    <span class="token comment"># concurs with nginx's one</span>
    <span class="token comment">#</span>
    location ~ /<span class="token punctuation">\</span>.ht <span class="token punctuation">{</span>
        deny  all<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    location <span class="token operator">=</span> /xmlrpc.php <span class="token punctuation">{</span>
        deny all<span class="token punctuation">;</span>
        error_page <span class="token number">403</span> <span class="token operator">=</span> /403.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate /etc/letsencrypt/live/goodsaem.ml/fullchain.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate_key /etc/letsencrypt/live/goodsaem.ml/privkey.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    include /etc/letsencrypt/options-ssl-nginx.conf<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>


<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> goodsaem.ml<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment"># managed by Certbot</span>
    server_name  goodsaem.ml<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">404</span><span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>



    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate /etc/letsencrypt/live/goodsaem.ml/fullchain.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_certificate_key /etc/letsencrypt/live/goodsaem.ml/privkey.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    include /etc/letsencrypt/options-ssl-nginx.conf<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem<span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>

<span class="token punctuation">}</span>


server <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$host</span> <span class="token operator">=</span> goodsaem.ml<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment"># managed by Certbot</span>




    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  goodsaem.ml<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">404</span><span class="token punctuation">;</span> <span class="token comment"># managed by Certbot</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br></div></div><p>letsencrypt 에 있는 Diffie-Hellman Key 를 아래와 같은 이름으로 백업합니다.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ubuntu@goodsaem:~$ <span class="token builtin class-name">cd</span> /etc/letsencrypt/
ubuntu@goodsaem:~$  <span class="token function">sudo</span> <span class="token function">mv</span> ssl-dhparams.pem  ssl-dhparams.pem.backup
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>생성한 키 파일을 /etc/letsencrypt 로 복사합니다.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ubuntu@goodsaem:~$  <span class="token function">sudo</span> <span class="token function">cp</span> -rp /etc/nginx/conf.d/ssl-dhparams.pem /etc/letsencrypt/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>nginx 를 재시작 합니다.</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ubuntu@goodsaem:~$ <span class="token function">sudo</span> systemctl restart nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/freetier2/110-aws-php-security-setting.html" class="prev">10. AWS security setting</a></span> <span class="next"><a href="/freetier2/112-aws-php-ssl-check.html">12. SSL check</a>
      →
    </span></p></div>  <div><div id="comment" class="comment"></div></div></main> <header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><figure><img src="https://avatars.githubusercontent.com/u/72680592?s=400&amp;u=745704d80b906fded3d9399a38120d35e6944318&amp;v=4" alt="goodSaem"></figure> <div><strong>goodsaem</strong> <em>좋은선생님</em></div></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Apps" class="dropdown-title"><span class="title">Apps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/apps/100-barcode-generator.html" class="nav-link">100-barcode-generator</a></li><li class="dropdown-item"><!----> <a href="/apps/101-qrcode-generator.html" class="nav-link">101-qrcode-generator</a></li><li class="dropdown-item"><!----> <a href="/apps/111-fontawesome-icon-search.html" class="nav-link">111-fontawesome-icon-search</a></li><li class="dropdown-item"><!----> <a href="/apps/201-memo-management.html" class="nav-link">201-memo-management</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/goodsaem/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repository
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Apps" class="dropdown-title"><span class="title">Apps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/apps/100-barcode-generator.html" class="nav-link">100-barcode-generator</a></li><li class="dropdown-item"><!----> <a href="/apps/101-qrcode-generator.html" class="nav-link">101-qrcode-generator</a></li><li class="dropdown-item"><!----> <a href="/apps/111-fontawesome-icon-search.html" class="nav-link">111-fontawesome-icon-search</a></li><li class="dropdown-item"><!----> <a href="/apps/201-memo-management.html" class="nav-link">201-memo-management</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/goodsaem/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repository
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/Hello.html" class="sidebar-link">Hello</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Apps</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>AWS+Springboot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>AWS+PHP</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/freetier2/101-aws-php-prepare.html" class="sidebar-link">1. Preparation for deployment</a></li><li><a href="/freetier2/102-aws-php-new-account.html" class="sidebar-link">2. Creating an AWS Account</a></li><li><a href="/freetier2/103-aws-php-ec2-instance-add.html" class="sidebar-link">3. Add EC2 Instance</a></li><li><a href="/freetier2/104-aws-php-server-connect.html" class="sidebar-link">4. Server connection</a></li><li><a href="/freetier2/105-aws-php-ec2-init-config.html" class="sidebar-link">5. Initial Settings</a></li><li><a href="/freetier2/106-aws-php-nginx-install.html" class="sidebar-link">6. Nginx install</a></li><li><a href="/freetier2/107-aws-php-mariadb-install.html" class="sidebar-link">7. MariaDB install</a></li><li><a href="/freetier2/108-aws-php-php-install.html" class="sidebar-link">8. PHP install</a></li><li><a href="/freetier2/109-aws-php-nginx-link.html" class="sidebar-link">9. Nginx config</a></li><li><a href="/freetier2/110-aws-php-security-setting.html" class="sidebar-link">10. AWS security setting</a></li><li><a href="/freetier2/111-aws-php-ssl-free-certificate.html" aria-current="page" class="active sidebar-link">11. Free Certificate Issuance</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/freetier2/112-aws-php-ssl-check.html" class="sidebar-link">12. SSL check</a></li><li><a href="/freetier2/113-aws-php-test.html" class="sidebar-link">13. test</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac+PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Setup</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <footer class="siteFooter"><div class="container"><p class="siteFooterCopyright">
      Copyright © 2021 All Right <em>goodsaem</em></p> <p class="siteFooterContact">
      goodsaem@protonmail.com
      <a href="https://github.com/goodsaem" target="_blank">GitHub</a> .
    </p></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4473d647.js" defer></script><script src="/assets/js/3.0812e6ab.js" defer></script><script src="/assets/js/28.c63ae85b.js" defer></script>
  </body>
</html>
